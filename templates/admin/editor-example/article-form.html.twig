{% extends 'admin/base.html.twig' %}

{% block title %}Formulaire d'Article - Custom Editor{% endblock %}

{% block body %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2">
        <i class="bi bi-newspaper me-2"></i>Exemple : Formulaire d'Article Complet
    </h1>
    <a href="{{ path('admin_editor_example_index') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-2"></i>Retour aux exemples
    </a>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title mb-0">
                    <i class="bi bi-pencil-square me-2"></i>Créer un Article
                </h3>
                <small class="text-muted">
                    Exemple d'utilisation complète de l'éditeur avec MediaTextareaType et MediaSelectorType
                </small>
            </div>
            <div class="card-body">
                {{ form_start(form, {'attr': {'class': 'needs-validation', 'novalidate': true}}) }}
                
                <div class="row">
                    <!-- Colonne principale -->
                    <div class="col-lg-8">
                        <!-- Titre -->
                        <div class="mb-4">
                            {{ form_label(form.title, null, {'label_attr': {'class': 'form-label fw-bold'}}) }}
                            {{ form_widget(form.title, {'attr': {'class': 'form-control form-control-lg'}}) }}
                            {{ form_errors(form.title) }}
                        </div>

                        <!-- Résumé -->
                        <div class="mb-4">
                            {{ form_label(form.excerpt, null, {'label_attr': {'class': 'form-label fw-bold'}}) }}
                            <small class="text-muted d-block mb-2">
                                <i class="bi bi-info-circle me-1"></i>
                                Court résumé sans médias, affiché dans les listes d'articles
                            </small>
                            {{ form_widget(form.excerpt) }}
                            {{ form_errors(form.excerpt) }}
                        </div>

                        <!-- Contenu principal -->
                        <div class="mb-4">
                            {{ form_label(form.content, null, {'label_attr': {'class': 'form-label fw-bold'}}) }}
                            <small class="text-muted d-block mb-2">
                                <i class="bi bi-magic me-1"></i>
                                Éditeur complet avec médias, sauvegarde automatique toutes les 30 secondes
                            </small>
                            {{ form_widget(form.content) }}
                            {{ form_errors(form.content) }}
                        </div>

                        <!-- Notes internes -->
                        <div class="mb-4">
                            {{ form_label(form.internalNotes, null, {'label_attr': {'class': 'form-label fw-bold'}}) }}
                            <small class="text-muted d-block mb-2">
                                <i class="bi bi-eye-slash me-1"></i>
                                Notes visibles uniquement en administration
                            </small>
                            {{ form_widget(form.internalNotes) }}
                            {{ form_errors(form.internalNotes) }}
                        </div>
                    </div>

                    <!-- Sidebar -->
                    <div class="col-lg-4">
                        <!-- Status -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h6 class="card-title mb-0">
                                    <i class="bi bi-gear me-2"></i>Publication
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="form-check mb-3">
                                    {{ form_widget(form.published, {'attr': {'class': 'form-check-input'}}) }}
                                    {{ form_label(form.published, null, {'label_attr': {'class': 'form-check-label'}}) }}
                                </div>
                                {{ form_errors(form.published) }}
                            </div>
                        </div>

                        <!-- Image de couverture -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h6 class="card-title mb-0">
                                    <i class="bi bi-image me-2"></i>Image de Couverture
                                </h6>
                            </div>
                            <div class="card-body">
                                <small class="text-muted d-block mb-3">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Sélection unique avec prévisualisation
                                </small>
                                {{ form_widget(form.featuredImage) }}
                                {{ form_errors(form.featuredImage) }}
                            </div>
                        </div>

                        <!-- Galerie -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h6 class="card-title mb-0">
                                    <i class="bi bi-images me-2"></i>Galerie d'Images
                                </h6>
                            </div>
                            <div class="card-body">
                                <small class="text-muted d-block mb-3">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Sélection multiple avec prévisualisation
                                </small>
                                {{ form_widget(form.gallery) }}
                                {{ form_errors(form.gallery) }}
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="card">
                            <div class="card-header">
                                <h6 class="card-title mb-0">
                                    <i class="bi bi-check2-square me-2"></i>Actions
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    {{ form_widget(form.save, {'attr': {'class': 'btn btn-outline-primary'}}) }}
                                    {{ form_widget(form.saveAndPublish, {'attr': {'class': 'btn btn-success'}}) }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                {{ form_end(form) }}
            </div>
        </div>
    </div>
</div>

<!-- Informations techniques -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card border-info">
            <div class="card-header bg-info text-white">
                <h6 class="card-title mb-0">
                    <i class="bi bi-code me-2"></i>Informations Techniques
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="fw-bold">FormTypes utilisés :</h6>
                        <ul class="list-unstyled">
                            <li><code>MediaTextareaType</code> - Éditeur avec médias</li>
                            <li><code>MediaSelectorType</code> - Sélecteur d'images</li>
                            <li><code>TextType</code> - Champ titre</li>
                            <li><code>CheckboxType</code> - Status publié</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6 class="fw-bold">Fonctionnalités activées :</h6>
                        <ul class="list-unstyled">
                            <li><i class="bi bi-check text-success me-2"></i>Sauvegarde automatique</li>
                            <li><i class="bi bi-check text-success me-2"></i>Gestionnaire de médias</li>
                            <li><i class="bi bi-check text-success me-2"></i>Redimensionnement d'images</li>
                            <li><i class="bi bi-check text-success me-2"></i>Drag & Drop</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_javascripts %}
<script>
$(document).ready(function() {
    // Configuration de la sauvegarde automatique personnalisée
    $('textarea[data-enable-auto-save="true"]').each(function() {
        const $textarea = $(this);
        const editor = $textarea.data('customEditor');
        
        if (editor) {
            // Personnaliser le callback de sauvegarde automatique
            editor.options.onAutoSave = function(content) {
                $.ajax({
                    url: '{{ path('admin_editor_example_auto_save') }}',
                    method: 'POST',
                    data: JSON.stringify({
                        content: content,
                        field: $textarea.attr('name'),
                        timestamp: new Date().toISOString()
                    }),
                    contentType: 'application/json',
                    success: function(response) {
                        if (response.success) {
                            // Afficher un indicateur de sauvegarde discrète
                            showAutoSaveIndicator('Brouillon sauvegardé', 'success');
                        }
                    },
                    error: function() {
                        showAutoSaveIndicator('Erreur de sauvegarde', 'error');
                    }
                });
            };
        }
    });
    
    function showAutoSaveIndicator(message, type) {
        const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
        const icon = type === 'success' ? 'bi-check-circle' : 'bi-exclamation-triangle';
        
        const indicator = $(`
            <div class="alert ${alertClass} alert-dismissible fade show position-fixed auto-save-indicator" 
                 style="top: 80px; right: 20px; z-index: 9999; min-width: 250px;">
                <i class="bi ${icon} me-2"></i>${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `);
        
        $('body').append(indicator);
        
        // Supprimer automatiquement après 3 secondes
        setTimeout(() => {
            indicator.fadeOut(500, function() {
                $(this).remove();
            });
        }, 3000);
    }
});
</script>
{% endblock %}